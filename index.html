<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACESSO PRIVADO</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        #cardInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            height: 100px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
        }
        #submitBtn {
            background-color: #007bff;
            color: white;
        }
        #submitBtn:hover {
            background-color: #0056b3;
        }
        #deleteBtn {
            background-color: #dc3545;
            color: white;
        }
        #deleteBtn:hover {
            background-color: #c82333;
        }
        #bandeiraSelect {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        #cardDeleteInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        #message {
            margin-bottom: 10px;
            font-size: 16px;
        }
        #stock {
            margin-top: 20px;
            text-align: left;
        }
        .stock-item {
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <p>CENTRAL DE DB THEOSTORE7</p>
        <textarea id="cardInput" placeholder="ADICIONE NO MODELO 6505210076088014|12|2024|573 RESPEITE O MODELO!!"></textarea>
        <button id="submitBtn" onclick="submitCards()">Submit</button>
        
        <select id="bandeiraSelect">
            <option value="" disabled selected>Select Bandeira</option>
            <option value="ELO">ELO</option>
            <option value="MASTERCARD">MASTERCARD</option>
            <option value="VISA">VISA</option>
            <!-- Adicione outras bandeiras conforme necessário -->
        </select>
        <input type="text" id="cardDeleteInput" placeholder="Enter card number to delete">
        <button id="deleteBtn" onclick="deleteCard()">Delete Card</button>

        <div id="message"></div>
        <div id="stock"></div>
    </div>

    <!-- Scripts do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

     <!-- Seu script personalizado -->
     <script>
        var firebaseConfig = {
  apiKey: "AIzaSyC56jWU4dlcUz8BFkJDIWXrCkcxEOmJXn0",
  authDomain: "theostore7db.firebaseapp.com",
  databaseURL: "https://theostore7db-default-rtdb.firebaseio.com",
  projectId: "theostore7db",
  storageBucket: "theostore7db.appspot.com",
  messagingSenderId: "796060734091",
  appId: "1:796060734091:web:9e92233bb0f116e3343a8e"
};
// Inicializa o Firebase
firebase.initializeApp(firebaseConfig);
var database = firebase.database();

 // Função para identificar o banco e a bandeira do cartão
 function identifyCardDetails(cardNumber) {
            // Exemplos de identificação - substitua por lógica real
            var bank = "Desconhecido";
            var bandeira = "Desconhecido";

            // Lógica de identificação baseada no número do cartão
            if (cardNumber.startsWith("4152")) {
                bank = "SANTANDER";
                bandeira = "ELO";
            } else if (cardNumber.startsWith("6505")) {
                bank = "OUTRO BANCO";
                bandeira = "MASTERCARD";
            } else if (cardNumber.startsWith("4854")) {
                bank = "ANOTHER BANK";
                bandeira = "VISA";
            }

            return { bank, bandeira };
        }

        // Função para enviar os dados ao Firebase
        function submitCards() {
            var cardDetails = document.getElementById("cardInput").value.split('\n');
            var message = document.getElementById("message");

            cardDetails.forEach(function(detail) {
                var [cardNumber, month, year, cvv] = detail.trim().split('|');
                
                // Ignora entradas inválidas
                if (!cardNumber || !month || !year || !cvv) {
                    console.error("Dados inválidos: ", detail);
                    return;
                }

                // Identifica o banco e a bandeira do cartão
                var { bank, bandeira } = identifyCardDetails(cardNumber);

                // Cria os dados a serem enviados
                var cardData = {
                    bandeira: bandeira,
                    bank: bank,
                    cardcvv: parseInt(cvv),
                    cardholdername: "null",
                    cardnumber: cardNumber,
                    cardval: `${month}|${year}`,
                    nivel: parseInt(cardNumber.slice(0, 6))
                };

                // Envia os dados ao Firebase
                database.ref('cards/' + cardNumber).set(cardData, function(error) {
                    if (error) {
                        console.error("Erro ao enviar dados: ", error);
                        message.innerText = "Erro ao enviar dados.";
                    } else {
                        console.log("Dados enviados com sucesso para o cartão: " + cardNumber);
                        message.innerText = "Cartões adicionados com sucesso.";
                        updateStock();
                    }
                });
            });
        }

        // Função para deletar o cartão do Firebase
        function deleteCard() {
            var bandeira = document.getElementById("bandeiraSelect").value;
            var cardNumber = document.getElementById("cardDeleteInput").value.trim();
            var message = document.getElementById("message");

            if (!bandeira || !cardNumber) {
                alert("Por favor, selecione uma bandeira e insira um número de cartão válido.");
                return;
            }

            // Verifica se o cartão existe e apaga
            database.ref('cards/' + cardNumber).once('value', function(snapshot) {
                if (snapshot.exists()) {
                    database.ref('cards/' + cardNumber).remove(function(error) {
                        if (error) {
                            console.error("Erro ao apagar cartão: ", error);
                            message.innerText = "Erro ao apagar cartão.";
                        } else {
                            console.log("Cartão apagado com sucesso: " + cardNumber);
                            message.innerText = "Cartão apagado com sucesso.";
                            updateStock();
                        }
                    });
                } else {
                    alert("Cartão não encontrado no banco de dados.");
                    message.innerText = "Cartão não encontrado.";
                }
            });
        }

        // Função para atualizar a lista de cartões
        function updateStock() {
            var stockDiv = document.getElementById("stock");
            stockDiv.innerHTML = "";
            
            database.ref('cards').once('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var cardData = childSnapshot.val();
                    var cardNumber = cardData.cardnumber;
                    var cardVal = cardData.cardval;
                    var cardCVV = cardData.cardcvv;
                    
                    var stockItem = document.createElement("div");
                    stockItem.className = "stock-item";
                    stockItem.innerText = `${cardNumber}|${cardVal}|${cardCVV}`;
                    stockDiv.appendChild(stockItem);
                });
            });
        }

        // Atualiza a lista de cartões ao carregar a página
        window.onload = function() {
            updateStock();
        }
    </script>
</body>
</html>

